<div [ngClass]="{
      message: true,
      'message-sender': isSender,
    }" [attr.data-id]="data._id" (click)="onClick()">
  <img [src]="data.senderId.img[0] | img" class="avatar" alt="" />

  <div #wrapper class="wrapper" [ngClass]="{
      'sender': isSender,
    }" (contextmenu)="onContextMenu($event)" data-long-press-delay="1000"
    [attr.data]="JSON.stringify({type: 'message', id: data._id, my: !isSender})">

    @if (this.repliedOn){
    <div class="replied-on-holder">
      <div class="replied-on-username">
        {{ this.repliedOn.senderId.username }}
      </div>
      <div class="replied-on-text">
        {{ this.repliedOn.text }}
      </div>
    </div>
    }
    <div class="username" *ngIf="this.showSender">
      {{ isSender ? data.senderId.username : "You" }}
    </div>

    <app-media-preview (openMedia)="onMediaGallery()" *ngIf="imageMedia.length > 0"
      [imageMedia]="imageMedia"></app-media-preview>

    <div (click)="stopPropagation($event)" (contextmenu)="stopPropagation($event)" class="media-holder"
      *ngIf="data.media && data.media.length > 0">
      @for (media of data.media; track media._id) {
      @if (!media.mime.startsWith('image/') && !media.mime.startsWith('video/')) {
      <div #mediaItem class="media-item" (contextmenu)="onContextMenu($event)" data-long-press-delay="1000"
        [attr.data]="JSON.stringify({type: 'media', id: media._id, path: media.path})">
        <svg icon="file"></svg>
        <p>{{ media.path }}</p>
      </div>
      }}
    </div>
    <div class="text">
      {{ data.text }}
      <div
        style="display:flex; position: relative; top: .375rem; bottom: auto !important; float: right; height: calc(var(--message-meta-height, 1rem)); margin-right: -0.375rem; margin-left: .4375rem; line-height: 1.35;">
        @if (data.editedAt.split(".")[0] !== data.createdAt.split(".")[0])
        {
        <p>edited </p>
        }
        <p>{{ data.createdAt | date: 'shortTime' }}</p>
        <svg icon="doublecheck"></svg>
      </div>
    </div>
  </div>

  <div class="message-select-box" *ngIf="selectMode"><input type="checkbox" [checked]="data.isSelected"
      (change)="selectMessage($event)" name="" id="" /></div>
</div>